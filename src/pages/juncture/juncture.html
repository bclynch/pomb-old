<PageWrapper [topo]="true">
  <div class="junctureBannerContainer">
    <div class="banner" [ngStyle]="{ 'background-image': 'url(' + bannerImg + ')'}">
      <div class="bannerTitle">{{junctureData?.name}}</div>
      <div class="bannerSubtitle">{{junctureData?.city}}, {{junctureData?.country}}</div>
    </div>
    <div class="bannerNavContainer">
      <div 
        class="priorJuncture" 
        (click)="routerService.navigateToPage('/juncture/' + priorJuncture.id)"
      >
        <ion-icon *ngIf="priorJuncture" name="ios-arrow-back"></ion-icon>
        <span *ngIf="priorJuncture">{{priorJuncture?.name}}</span>
      </div>
      <div class="junctureTrip" (click)="routerService.navigateToPage('/trip/' + junctureData.tripByTripId.id)">{{junctureData?.tripByTripId.name}}</div>
      <div 
        class="nextJuncture" 
        (click)="routerService.navigateToPage('/juncture/' + nextJuncture.id)"
      >
        <span *ngIf="nextJuncture">{{nextJuncture?.name}}</span>
        <ion-icon *ngIf="nextJuncture" name="ios-arrow-forward"></ion-icon>
      </div>
    </div>
  </div>

  <div class="widthWrapper">
    <div class="junctureDescription" [froalaView]="junctureData?.description"></div>
    <div class="infoContainer">
      <div class="mapContainer">
        <agm-map 
          [zoomControl]="false"
          [disableDefaultUI]="true"
          [streetViewControl]="false"
          [mapDraggable]="false"
          [scrollwheel]="false"
          [fitBounds]="latlngBounds" 
          [styles]=mapStyle
          [latitude]="markerLat" 
          [longitude]="markerLon"
          [zoom]="zoomLevel"
          mapTypeId="terrain" 
        >
          <agm-data-layer 
            [geoJson]="geoJsonObject" 
            (layerClick)="clicked($event)" 
            [style]="dataLayerStyle"
            *ngIf="isGPX"
          ></agm-data-layer>
          <agm-marker 
            *ngIf= "!isGPX"
            [latitude]= "markerLat" 
            [longitude]= "markerLon" 
            [iconUrl]= "{
              url: junctureData?.markerImg || 'https://www.imojado.org/wp-content/uploads/2016/08/1470289254_skylab-studio.png',
              anchor: {x: 18, y: 18},
              size: {width: 32, height: 32},
              scaledSize: {width: 32, height: 32}
            }"
          ></agm-marker>
        </agm-map>
      </div>
      <div class="statsContainer" *ngIf="isGPX">
        <h2>Juncture Statistics</h2>
        <UnitToggle></UnitToggle>
        <div class="statsGrid">
          <div class="statWrapper" *ngFor="let stat of stats;">
            <div class="innerWrapper">
              <ion-icon [name]="stat.icon" [style.color]="stat.iconColor"></ion-icon>
              <div class="statData">
                <div class="statLabel">{{stat.label}}</div>
                <div class="statValue">{{stat.value}} <span>{{stat.unitOfMeasure}}</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <div class="chartsContainer" *ngIf="isGPX && inited">
      <div>
        <chart
          type="line"
          [chartOptions]="distanceChartOptions"
          [chartData]="distanceChartData"
        ></chart>
      </div>
      <div>
        <chart
          type="line"
          [chartOptions]="timeChartOptions"
          [chartData]="timeChartData"
        ></chart>
      </div>
    </div>
    <Gallery [data]="junctureData?.imagesByJunctureId.nodes" gutterWidth="2px"></Gallery>
  </div>
</PageWrapper>